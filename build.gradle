import java.nio.file.Files
import java.nio.file.Paths
import java.nio.file.StandardCopyOption

plugins {
    id 'java'
}

group 'net.forthecrown'
version '1.2.1'

repositories {
    mavenCentral()
}

dependencies {
}

tasks.register('moveAll') {
    it.dependsOn(
            project("Plugin").getTasks().getByName("remap"),
            project("Grenadier").getTasks().getByName("remap")
    )

    it.doLast {
        moveToBuild("Standalone", true)
        moveToBuild("Standalone", false)
        moveToBuild("Plugin", false)

        cleanRemapFolder()
    }
}

void cleanRemapFolder() {
    File plLeftOver = new File(projectDir.absolutePath + '/remapping/Plugin-' + version + '-all.jar')
    if(plLeftOver.exists()) plLeftOver.delete()
}

void moveToBuild(String filePrefix, boolean remapped) {
    String fileName = "Grenadier-" + filePrefix + '-' + version + (remapped ? "-remapped" : "") + '.jar'
    String dir = '/remapping/' + fileName

    String projDirPath = projectDir.absolutePath

    Files.move(
            Paths.get(projDirPath + dir),
            Paths.get(projDirPath + "/build/" + fileName),
            StandardCopyOption.REPLACE_EXISTING
    )
}